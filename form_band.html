<!doctype html>
<html lang=pt>
    <head>
        <meta charset=utf-8>
        <title>Bandejando</title>
        <style>
            .msgBox {
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%,-50%);
              width: 200px;
              background: #eee;
            }
      
            .msgBox p {
              line-height: 1.5;
              padding: 10px 20px;
              color: #333;
            }
      
            .msgBox button {
              background: none;
              border: none;
              position: absolute;
              top: 0;
              right: 0;
              font-size: 1.1rem;
              color: #aaa;
            }
      
          </style>
    </head>
    <body>
        <form action="http://localhost:8000" method="post">
            <p><input type="text" name="matricula" id="matricula" title="Somente números" pattern="[1-9]{1}[0-9]{9}" onkeypress="return onlyNumberKey(event)" maxlength="10"></p>
            <label for="horarios">Escolha um horário:</label>

            <select name="hor_disp" id="horarios">
                <option value="0" selected disabled hidden>Escolha um horário</option>
                <option value="1145">11:45</option>
                <option value="1215">12:15</option>
                <option value="1245">12:45</option>
                <option value="1315">13:15</option>
                <option value="1700">17:00</option>
                <option value="1730">17:30</option>
                <option value="1800">18:00</option>
            </select>
            <p><button type="button" required>Agendar</button></p>
        </form>
        <div id="time"></div>
        <script>
            var btn = document.querySelector('button');
            
            btn.onclick = display;

            function display(){
                var html = document.querySelector('html');

                var panel = document.createElement('div');
                panel.setAttribute('class', 'msgBox');
                html.appendChild(panel);

                matr = document.getElementById("matricula").value
                selected = document.getElementById("horarios")
                select = selected.options[selected.selectedIndex].text

                var msg = document.createElement('p');
                msg.textContent = 'Matrícula '+matr+' reservada para '+select;
                panel.appendChild(msg);

                var closeBtn = document.createElement('button');
                closeBtn.textContent = 'x';
                panel.appendChild(closeBtn);

                closeBtn.onclick = function() {
                    panel.parentNode.removeChild(panel);
                }
            }



            
            function showHours(){
                function checkTime(i) {
                    if (i < 10) {
                        i = "0" + i;
                    }
                    return i;
                }

                function startTime() {
                    var today = new Date();
                    var h = today.getHours();
                    var m = today.getMinutes();
                    var s = today.getSeconds();
                    // add a zero in front of numbers<10
                    m = checkTime(m);
                    s = checkTime(s);
                    document.getElementById('time').innerHTML = h + ":" + m + ":" + s;
                    t = setTimeout(function() {
                        startTime()
                    }, 500);
                }
                startTime();
            }
            
            showHours();

            var h = today.getHours();
            var m = today.getMinutes();
            hour = h + ":" + m

            


            function timeToDecimal(t) {
                var arr = t.split(':');
                var dec = parseInt((arr[1]/6)*10, 10);

                return parseFloat(parseInt(arr[0], 10) + '.' + (dec<10?'0':'') + dec);
            }

            times = timeToDecimal(hour)

            $('#horarios option').filter(function () {
                return (parseInt(this.value,10) > times || (parseInt(this.value,10) - times) > 300 );
            }).hide();


            function onlyNumberKey(evt) {
         
                var ASCIICode = (evt.which) ? evt.which : evt.keyCode
                if (ASCIICode > 31 && (ASCIICode < 48 || ASCIICode > 57))
                    return false;
                return true;
            }
        </script>       
    </body>
</html>